---
import Layout from "../layouts/Layout.astro";
import PhotoGrid from "../components/PhotoGrid.astro";
import { photos, type PhotoInfo } from "../data/photos";

// get unique tags
const uniqueTags = [...new Set(photos.flatMap((p: PhotoInfo) => p.tags))].sort(
  (a: string, b: string) => {
    if (a === "Outros") return 1;
    if (b === "Outros") return -1;
    return a.localeCompare(b);
  }
);
const allTags = ["Todas", ...uniqueTags];
---

<Layout title="Fotografia | João Moreira" theme="light">
  <div class="max-w-6xl mx-auto w-full">
    <header class="mb-12 max-w-2xl">
      <h1 class="text-4xl font-bold tracking-tighter text-zinc-900 mb-4">
        Fotografia
      </h1>
      <p class="text-xl text-zinc-600 font-light">
        Olhar editorial sobre o quotidiano. Uma exploração visual do espaço, da
        luz e das ruas.
      </p>
    </header>

    <div class="flex flex-wrap gap-2 mb-10" id="filter-container">
      {
        allTags.map((tag) => (
          <button
            class={`filter-btn px-4 py-2 rounded-full text-sm font-medium border transition-colors ${
              tag === "Todas"
                ? "bg-zinc-900 text-white border-zinc-900"
                : "bg-white text-zinc-600 border-zinc-200 hover:border-zinc-400"
            }`}
            data-tag={tag}
          >
            {tag}
          </button>
        ))
      }
    </div>

    <PhotoGrid photos={photos} />
  </div>

  <script>
    // Script runs only on the client
    document.addEventListener("DOMContentLoaded", () => {
      const filterBtns = document.querySelectorAll(".filter-btn");
      const photoLinks = document.querySelectorAll("#photo-grid a[data-tags]");

      filterBtns.forEach((btn) => {
        btn.addEventListener("click", () => {
          const selectedTag = btn.getAttribute("data-tag");

          // Update button styles
          filterBtns.forEach((b) => {
            b.classList.remove("bg-zinc-900", "text-white", "border-zinc-900");
            b.classList.add("bg-white", "text-zinc-600", "border-zinc-200");
          });
          btn.classList.add("bg-zinc-900", "text-white", "border-zinc-900");
          btn.classList.remove("bg-white", "text-zinc-600", "border-zinc-200");

          // Filter photos
          photoLinks.forEach((link) => {
            const photoTags = link.getAttribute("data-tags")?.split(",") || [];
            if (link instanceof HTMLElement) {
              if (
                selectedTag === "Todas" ||
                photoTags.includes(selectedTag || "")
              ) {
                link.style.display = "block";
              } else {
                link.style.display = "none";
              }
            }
          });
        });
      });
    });
  </script>
</Layout>
