---
import Layout from "../../layouts/Layout.astro";
import PhotoGrid from "../../components/PhotoGrid.astro";
import { photos, type PhotoInfo } from "../../data/photos";

export function getStaticPaths() {
    return photos.map((photo: PhotoInfo) => {
        return {
            params: { id: photo.id },
            props: { photo },
        };
    });
}

const { photo } = Astro.props;

// Get related photos based on tags (excluding the current one)
const relatedPhotos = photos
    .filter(
        (p: PhotoInfo) =>
            p.id !== photo.id &&
            p.tags.some((tag: string) => photo.tags.includes(tag))
    )
    .slice(0, 3); // show up to 3 related
---

<Layout title={`${photo.title} | Fotografia | João Moreira`} theme="light">
    <div class="max-w-6xl mx-auto w-full">
        <div class="mb-8">
            <a
                href="/fotografia"
                class="inline-flex items-center text-sm font-medium text-zinc-500 hover:text-zinc-900 transition-colors"
            >
                &larr; Voltar à galeria
            </a>
        </div>

        <div class="mb-12 flex justify-center w-full">
            <img
                src={photo.image}
                alt={photo.alt}
                class="max-h-[85vh] w-auto object-contain"
            />
        </div>

        <div class="grid md:grid-cols-3 gap-12 mb-20">
            <div class="md:col-span-1 space-y-6">
                <h1 class="text-4xl font-bold tracking-tighter text-zinc-900">
                    {photo.title}
                </h1>
                <div class="flex flex-wrap gap-2">
                    {
                        photo.tags.map((tag: string) => (
                            <span class="px-3 py-1 bg-zinc-100 text-zinc-600 text-sm font-medium rounded-full border border-zinc-200">
                                {tag}
                            </span>
                        ))
                    }
                </div>
                {
                    photo.description && (
                        <p class="text-zinc-600 text-lg leading-relaxed mt-4">
                            {photo.description}
                        </p>
                    )
                }
            </div>

            <div
                class="md:col-span-2 bg-zinc-50 border border-zinc-200 p-6 rounded-2xl flex flex-col"
            >
                <h3
                    class="font-semibold text-zinc-900 uppercase tracking-widest text-xs mb-6"
                >
                    Detalhes Técnicos
                </h3>

                <div
                    class="grid grid-cols-2 gap-x-6 gap-y-4 flex-grow content-start"
                >
                    {
                        photo.date && (
                            <div class="flex flex-col text-sm border-b border-zinc-200 pb-2">
                                <span class="text-zinc-500 mb-1">Data</span>
                                <span class="font-medium text-zinc-900">
                                    {photo.date}
                                </span>
                            </div>
                        )
                    }
                    {
                        photo.location && (
                            <div class="flex flex-col text-sm border-b border-zinc-200 pb-2">
                                <span class="text-zinc-500 mb-1">Local</span>
                                <span class="font-medium text-zinc-900">
                                    {photo.location}
                                </span>
                            </div>
                        )
                    }
                    {
                        photo.camera && (
                            <div class="flex flex-col text-sm border-b border-zinc-200 pb-2">
                                <span class="text-zinc-500 mb-1">Câmara</span>
                                <span class="font-medium text-zinc-900">
                                    {photo.camera}
                                </span>
                            </div>
                        )
                    }
                    {
                        photo.lens && (
                            <div class="flex flex-col text-sm border-b border-zinc-200 pb-2">
                                <span class="text-zinc-500 mb-1">Lente</span>
                                <span class="font-medium text-zinc-900">
                                    {photo.lens}
                                </span>
                            </div>
                        )
                    }
                    {
                        photo.aperture && (
                            <div class="flex flex-col text-sm border-b border-zinc-200 pb-2">
                                <span class="text-zinc-500 mb-1">Abertura</span>
                                <span class="font-medium text-zinc-900">
                                    {photo.aperture}
                                </span>
                            </div>
                        )
                    }
                    {
                        photo.shutterSpeed && (
                            <div class="flex flex-col text-sm border-b border-zinc-200 pb-2">
                                <span class="text-zinc-500 mb-1">
                                    Obturação
                                </span>
                                <span class="font-medium text-zinc-900">
                                    {photo.shutterSpeed}
                                </span>
                            </div>
                        )
                    }
                    {
                        photo.iso && (
                            <div class="flex flex-col text-sm border-b border-transparent pb-2">
                                <span class="text-zinc-500 mb-1">ISO</span>
                                <span class="font-medium text-zinc-900">
                                    {photo.iso}
                                </span>
                            </div>
                        )
                    }
                </div>
            </div>
        </div>

        {
            relatedPhotos.length > 0 && (
                <div class="border-t border-zinc-200 pt-16">
                    <h2 class="text-2xl font-bold tracking-tight text-zinc-900 mb-8">
                        Fotografias Relacionadas
                    </h2>
                    <PhotoGrid photos={relatedPhotos} />
                </div>
            )
        }
    </div>
</Layout>
